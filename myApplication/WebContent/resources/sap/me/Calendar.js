/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.me.Calendar");jQuery.sap.require("sap.me.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.me.Calendar",{metadata:{publicMethods:["getSelectedDates","toggleDatesSelection","toggleDatesRangeSelection","unselectAllDates","toggleDatesType"],library:"sap.me",properties:{"visible":{type:"boolean",group:"Misc",defaultValue:true},"hideNavControls":{type:"boolean",group:"Misc",defaultValue:false},"hideMonthTitles":{type:"boolean",group:"Misc",defaultValue:false},"monthsPerRow":{type:"int",group:"Misc",defaultValue:0},"dayWidth":{type:"int",group:"Misc",defaultValue:45},"dayHeight":{type:"int",group:"Misc",defaultValue:50},"weeksPerRow":{type:"int",group:"Misc",defaultValue:1},"singleRow":{type:"boolean",group:"Misc",defaultValue:null},"monthsToDisplay":{type:"int",group:"Misc",defaultValue:1},"currentDate":{type:"string",group:"Misc",defaultValue:null},"enableMultiselection":{type:"boolean",group:"Misc",defaultValue:false},"firstDayOffset":{type:"int",group:"Misc",defaultValue:0},"disabledWeekDays":{type:"any",group:"Misc",defaultValue:null},"disabledDates":{type:"any",group:"Misc",defaultValue:null},"swipeToNavigate":{type:"boolean",group:"Misc",defaultValue:false},"design":{type:"sap.me.CalendarDesign",group:"Appearance",defaultValue:sap.me.CalendarDesign.Approval},"width":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"days":{type:"any",group:"Appearance",defaultValue:null},"months":{type:"any",group:"Appearance",defaultValue:null}},events:{"tapOnDate":{},"changeCurrentDate":{},"changeRange":{}}}});sap.me.Calendar.M_EVENTS={'tapOnDate':'tapOnDate','changeCurrentDate':'changeCurrentDate','changeRange':'changeRange'};
sap.me.Calendar.prototype.init=function(){var d=new Date();this.setProperty("currentDate",d.toDateString(),true);jQuery.sap.require("sap.ui.core.LocaleData");var o=sap.m.getLocaleData();this.setDays(o.getDays("abbreviated"));this.setMonths(o.getMonths("abbreviated"));var p=new sap.ui.core.Icon({src:"navigation-left-arrow"});p.addStyleClass("sapMeCalendarPrevious");p.attachPress(null,this._gotoPrevious,this);p.setParent(this);this._oPrevBtn=p;var n=new sap.ui.core.Icon({src:"navigation-right-arrow"});n.addStyleClass("sapMeCalendarNext");n.attachPress(null,this._gotoNext,this);n.setParent(this);this._oNextBtn=n;this._oDatesClasses={};this._$interactiveDates=null};
sap.me.Calendar.prototype.exit=function(){this._oPrevBtn.destroy();delete this._oPrevBtn;this._oNextBtn.destroy();delete this._oNextBtn;delete this._oDatesClasses;delete this._$interactiveDates;delete this._$fromDate;delete this._$toDate};
sap.me.Calendar.prototype.onBeforeRendering=function(){delete this._$interactiveDates};
sap.me.Calendar.prototype.onAfterRendering=function(){var $=this.$();var a=null;var d=this.getDisabledWeekDays()||[];var c=[];for(var i=0;i<d.length;i++){c.push(".sapMeCalendarWeekDay"+d[i])}var I=this.getSingleRow()||this.getMonthsToDisplay()===1;if(!I){c.push(".sapMeCalendarDayNotInCurrentMonth")}if(c.length){var t=c.join(", ");$.find(".sapMeCalendarMonth > div.sapMeCalendarMonthDays").children(t).css({"pointer-events":"none"});a=$.find(".sapMeCalendarMonth > div.sapMeCalendarMonthDays > .sapMeCalendarMonthDay:not("+t+")")}else{a=$.find(".sapMeCalendarMonth > div.sapMeCalendarMonthDays > .sapMeCalendarMonthDay")}var D=this.getDisabledDates()||[];for(var i=0;i<D.length;i++){var s=D[i];a.children("input[value='"+s+"']").parent().css({"pointer-events":"none"})}for(var s in this._oDatesClasses){var S=this._oDatesClasses[s].join(" ");a.children("input[value='"+s+"']").parent().addClass(S)}this._$interactiveDates=a;var h=this.getHideNavControls();this._oPrevBtn.$().css({display:h?"none":""});this._oNextBtn.$().css({display:h?"none":""})};
sap.me.Calendar.prototype.setEnableMultiselection=function(e){return this.setProperty("enableMultiselection",e,true)};
sap.me.Calendar.prototype.setHideNavControls=function(h){if(this.getDomRef()){this._oPrevBtn.$().css({display:h?"none":""});this._oNextBtn.$().css({display:h?"none":""})}return this.setProperty("hideNavControls",h,true)};
sap.me.Calendar.prototype.setHideMonthTitles=function(h){if(this.getDomRef()){this.$().find(".sapMeCalendarMonthName").css({display:h?"none":""})}return this.setProperty("hideMonthTitles",h,true)};
sap.me.Calendar.prototype.setFirstDayOffset=function(o){o=o%this.getDays().length;return this.setProperty("firstDayOffset",o)};
sap.me.Calendar.prototype.setWeeksPerRow=function(w){w=w%5;return this.setProperty("weeksPerRow",w)};
sap.me.Calendar.prototype.setDisabledWeekDays=function(w){w=w||[];return this.setProperty("disabledWeekDays",w)};
sap.me.Calendar.prototype.setDisabledDates=function(d){d=d||[];for(var i=0;i<d.length;i++){var D=d[i];if(typeof D=="string"){D=new Date(D)}var s=D.toDateString();d[i]=s}return this.setProperty("disabledDates",d)};
sap.me.Calendar.prototype.ontouchstart=function(e){if(!this.getSwipeToNavigate()){this._gestureStart(e)}};
sap.me.Calendar.prototype._gestureStart=function(e){this._$fromDate=this.getEnableMultiselection()?this._getDateDomRef(e.target):null};
sap.me.Calendar.prototype.ontouchmove=function(e){if(!this.getSwipeToNavigate()){this._gestureMove(e)}};
sap.me.Calendar.prototype._gestureMove=function(e){if(this._$fromDate){if(!this._$toDate){this._$fromDate.addClass("sapMeCalendarHighlight");this._$toDate=this._$fromDate}e.stopPropagation();e.preventDefault();var d=e.target;if(e.touches.length){var t=e.touches[0];d=document.elementFromPoint(t.clientX,t.clientY)}var $=this._getDateDomRef(d);if($&&$!=this._$toDate){this._$toDate.removeClass("sapMeCalendarHighlight");this._$fromDate.addClass("sapMeCalendarHighlight");$.addClass("sapMeCalendarHighlight");this._$toDate=$}}};
sap.me.Calendar.prototype.ontouchend=function(e){if(!this.getSwipeToNavigate()){this._gestureEnd(e)}};
sap.me.Calendar.prototype._gestureEnd=function(e){if(this._$fromDate&&this._$toDate){e.stopPropagation();e.preventDefault();var f=this._getDateValue(this._$fromDate);var t=this._getDateValue(this._$toDate);this._$fromDate.removeClass("sapMeCalendarHighlight");this._$toDate.removeClass("sapMeCalendarHighlight");this.toggleDatesRangeSelection(f,t,true);this.fireChangeRange({fromDate:f,toDate:t})}delete this._$fromDate;delete this._$toDate};
sap.me.Calendar.prototype.ontap=function(e){this._gestureSelect(e)};
sap.me.Calendar.prototype._gestureSelect=function(e){var $=this._getDateDomRef(e.target);if($){var d=this._getDateValue($);var D=!$.hasClass("sapMeCalendarSelected");if(!this.getEnableMultiselection()){this.unselectAllDates()}$.toggleClass("sapMeCalendarSelected",D);this._updateDatesWithClass("sapMeCalendarSelected",d,D);this.fireTapOnDate({didSelect:D,date:d})}};
sap.me.Calendar.prototype.onswipeleft=function(e){if(this.getSwipeToNavigate()){this._gotoNext()}};
sap.me.Calendar.prototype.onswiperight=function(e){if(this.getSwipeToNavigate()){this._gotoPrevious()}};
sap.me.Calendar.prototype.getSelectedDates=function(){return this._getDatesWithStyleClass("sapMeCalendarSelected")};
sap.me.Calendar.prototype.toggleDatesSelection=function(d,s){this._toggleDatesStyleClass("sapMeCalendarSelected",d,s)};
sap.me.Calendar.prototype.toggleDatesType=function(d,t,s){this._toggleDatesStyleClass("sapMeCalendar"+t,d,s)};
sap.me.Calendar.prototype.removeTypesOfAllDates=function(){this._removeStyleClassOfAllDates("sapMeCalendar"+sap.me.CalendarEventType.Type00);this._removeStyleClassOfAllDates("sapMeCalendar"+sap.me.CalendarEventType.Type01);this._removeStyleClassOfAllDates("sapMeCalendar"+sap.me.CalendarEventType.Type04);this._removeStyleClassOfAllDates("sapMeCalendar"+sap.me.CalendarEventType.Type06);this._removeStyleClassOfAllDates("sapMeCalendar"+sap.me.CalendarEventType.Type07)};
sap.me.Calendar.prototype.unselectAllDates=function(){this._removeStyleClassOfAllDates("sapMeCalendarSelected")};
sap.me.Calendar.prototype.toggleDatesRangeSelection=function(d,D,s){this._toggleDatesRangeStyleClass("sapMeCalendarSelected",d,D,s)};
sap.me.Calendar.prototype._getDatesWithStyleClass=function(s){var d=[];for(var D in this._oDatesClasses){if(jQuery.inArray(s,this._oDatesClasses[D])!==-1){d.push(D)}}return d};
sap.me.Calendar.prototype._toggleDatesRangeStyleClass=function(c,d,D,a){if(typeof d=="string"){d=new Date(d)}if(typeof D=="string"){D=new Date(D)}if(d&&D&&typeof d.getTime=="function"&&typeof D.getTime=="function"){if(d>D){var t=new Date(d.getTime());d=D;D=t}var b=[];var o=new Date(d.getTime());while(D-o>=0){b.push(o.toDateString());o.setDate(o.getDate()+1)}this._toggleDatesStyleClass(c,b,a)}};
sap.me.Calendar.prototype._toggleDatesStyleClass=function(c,d,a){for(var i=0;i<d.length;i++){var D=d[i];if(typeof D=="string"){D=new Date(D)}var s=D.toDateString();d[i]=s;this._updateDatesWithClass(c,s,a);if(this._$interactiveDates){this._$interactiveDates.children("input[value='"+s+"']").parent().toggleClass(c,a)}}};
sap.me.Calendar.prototype._removeStyleClassOfAllDates=function(c){for(var d in this._oDatesClasses){this._updateDatesWithClass(c,d,false)}if(this._$interactiveDates){this._$interactiveDates.removeClass(c)}};
sap.me.Calendar.prototype._gotoPrevious=function(){var c=this.getCurrentDate();var a=new Date(c);var s=this.getSingleRow();if(s){a.setDate(a.getDate()-7)}else{a.setDate(0);a.setDate(1)}var C=a.toDateString();this.setCurrentDate(C);this.fireChangeCurrentDate({currentDate:C})};
sap.me.Calendar.prototype._gotoNext=function(){var c=this.getCurrentDate();var a=new Date(c);var s=this.getSingleRow();if(s){a.setDate(a.getDate()+7)}else{a.setDate(32);a.setDate(1)}var C=a.toDateString();this.setCurrentDate(C);this.fireChangeCurrentDate({currentDate:C})};
sap.me.Calendar.prototype._updateDatesWithClass=function(c,d,a){var s=this._oDatesClasses[d]||[];var i=jQuery.inArray(c,s);if(a&&i===-1){s.push(c)}else if(!a&&i!==-1){s.splice(i,1)}if(s.length===0){this._oDatesClasses[d]=null;delete this._oDatesClasses[d]}else{this._oDatesClasses[d]=s}};
sap.me.Calendar.prototype._getDateValue=function($){return $.children("input").eq(0).val()};
sap.me.Calendar.prototype._getMonthDate=function(d){var $=jQuery(d);var a=jQuery(this.getDomRef());while($&&$!=a&&!$.hasClass("sapMeCalendarMonthDay")){$=$.parent()}return $&&$.parent().hasClass("sapMeCalendarMonth")?$:null};
sap.me.Calendar.prototype._getDateDomRef=function(d){var $=d?jQuery(d):null;var t=this.getId();var a=null;while($&&$[0].id!=t&&!$.hasClass("sapMeCalendarMonth")){if($.hasClass("sapMeCalendarMonthDay")&&$.parent().hasClass("sapMeCalendarMonthDays")){a=$;break}$=$.parent()}return a};
